# Implementation Plan: Supabase Login and Signup

**Branch**: `002-add-supabase-login` | **Date**: 2025-10-04 | **Spec**: [/Users/jin/Code/Chill/specs/002-add-supabase-login/spec.md](/Users/jin/Code/Chill/specs/002-add-supabase-login/spec.md)
**Input**: Feature specification from `/Users/jin/Code/Chill/specs/002-add-supabase-login/spec.md`

## Execution Flow (/plan command scope)
```
1. Load feature spec from Input path
2. Fill Technical Context using clarifications
3. Populate Constitution Check and ensure alignment
4. Mark Initial Constitution Check PASS
5. Execute Phase 0 research → research.md (completed)
6. Execute Phase 1 design outputs → data-model.md, contracts/, quickstart.md, agent update (completed)
7. Re-run Constitution Check and mark PASS
8. Outline Phase 2 task strategy
9. STOP – ready for /tasks command
```

## Summary
Enable authenticated access to Chill by integrating Supabase email/password login, signup, and OTP-driven password reset. Preserve the existing welcome surface while adding authentication flows that honor MVVM structure, offline safeguards, Supabase session defaults, and privacy-aware telemetry.

## Technical Context
**Language/Version**: Swift 6 toolchain (Xcode 16)  
**Primary Dependencies**: SwiftUI, `supabase-swift` SDK, Combine, Network framework for reachability  
**Storage**: Supabase-hosted Postgres (remote); on-device secure storage via Keychain (handled by SDK)  
**Testing**: XCTest unit tests, view-model tests, SwiftUI snapshot tests (UITests deferred until Supabase flows ship)  
**Target Platform**: iOS 18.0+ (matches project deployment target)  
**Project Type**: Mobile (single iOS app target)  
**Performance Goals**: Auth round-trips should surface feedback within 2 seconds on good networks; retry guidance within 5 seconds when offline  
**Constraints**: Offline-capable submission guard, accessibility parity, no storage of plaintext credentials  
**Scale/Scope**: Single-user auth surface linking welcome screen to authenticated shell; anticipates thousands of daily logins with Supabase-managed scaling

## Constitution Check
- [x] **SwiftUI Experience Integrity** → Plan details new SwiftUI surfaces, MVVM boundaries, accessibility (Dynamic Type, VoiceOver) for auth forms and OTP flow.
- [x] **Calm State & Offline Resilience** → Research covers offline gating, retry banners, session handling, and state transitions.
- [x] **Observability With Privacy Guarantees** → Telemetry blueprint defined (auth events, redacted data) and Supabase logs monitored.
- [x] **Test-First Delivery** → Strategy relies on view-model + snapshot tests before wiring UI; UITests reintroduced post-auth completion.
- [x] **Release Confidence & Support** → Quickstart enumerates validation steps and rollout notes outline rollback communications without relying on feature flags.

## Project Structure

### Documentation
```
specs/002-add-supabase-login/
├── plan.md
├── spec.md
├── research.md
├── data-model.md
├── quickstart.md
├── contracts/
│   └── auth-flow.md
└── tasks.md  # generated by /tasks
```

### Source Code (selected folders)
```
Chill/
└── Chill/
    ├── Features/
    │   ├── Welcome/
    │   ├── Auth/
    │   │   ├── AuthView.swift
    │   │   ├── AuthViewModel.swift
    │   │   ├── AuthService.swift
    │   │   └── Components/
    │   └── SavedLinks/
    │       └── SavedLinksView.swift
    ├── Support/
    │   └── DesignSystem/
    └── Resources/
        └── Config/

ChillTests/
├── Auth/
│   ├── AuthViewModelTests.swift
│   └── AuthServiceTests.swift
└── SavedLinks/
    └── SavedLinksViewTests.swift (placeholder)

ChillUITests/
└── Auth/
    └── (future end-to-end tests)
```

**Structure Decision**: Extend the existing mobile app structure with dedicated `Auth` and `SavedLinks` feature modules under `Chill/Chill/Features`, mirrored by unit tests in `ChillTests/`. UITests remain deferred but namespace reserved.

## Phase 0: Outline & Research
1. Document Supabase SDK usage, session handling, OTP flow, and observability requirements (see `research.md`).
2. Capture open follow-ups for analytics schema and content design tone.
3. Outcome: `research.md` finalized, no blocking unknowns besides telemetry schema ownership.

## Phase 1: Design & Contracts
1. Translate entities and view-model state into `data-model.md` (AuthService protocol, AuthViewModel, AuthSession, telemetry payloads).
2. Capture end-to-end auth flow contract (`contracts/auth-flow.md`) covering screens, API interactions, and error handling.
3. Produce `quickstart.md` with Supabase CLI usage, environment configuration, and manual validation steps.
4. Update agent context (`.specify/scripts/bash/update-agent-context.sh codex`) after plan completion.

## Phase 2: Task Planning Approach
- Use `/tasks` to derive failing test-first tasks: AuthService protocol tests, ViewModel tests, snapshot coverage, error taxonomy checks.
- Add placeholder SavedLinksView tasks (rendering + basic snapshot) to confirm navigation post-auth.
- Include instrumentation tasks for auth events and Supabase environment configuration (no feature flag expected).
- Mark parallelizable tasks for copywriting/content updates and analytics coordination once schemas are confirmed.

## Phase 3+: Future Implementation
- Phase 3 (`/tasks`): generate ordered task list with TDD emphasis.
- Phase 4: Implement auth flows, integrate Supabase SDK, ensure secure storage/offline handling, and render SavedLinksView for authenticated state.
- Phase 5: Validate via unit/snapshot tests, manual end-to-end auth, Supabase dashboard monitoring.

## Complexity Tracking
*(No deviations required at this stage.)*

| Violation | Why Needed | Simpler Alternative Rejected Because |
|-----------|------------|-------------------------------------|

## Progress Tracking

**Phase Status**:
- [x] Phase 0: Research complete (/plan command)
- [x] Phase 1: Design complete (/plan command)
- [x] Phase 2: Task planning complete (/plan command - describe approach only)
- [ ] Phase 3: Tasks generated (/tasks command)
- [ ] Phase 4: Implementation complete
- [ ] Phase 5: Validation passed

**Gate Status**:
- [x] Initial Constitution Check: PASS
- [x] Post-Design Constitution Check: PASS
- [x] All NEEDS CLARIFICATION resolved
- [ ] Complexity deviations documented

---
*Based on Constitution v1.1.0 - See `/Users/jin/Code/Chill/.specify/memory/constitution.md`*
